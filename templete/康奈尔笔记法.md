<%*
// --- 🤖 脚本区 ---
// 1. 获取文件名 & 弹窗改名
let fileName = tp.file.title;
let newName = await tp.system.prompt("1/4 📝 请输入笔记标题：", fileName);
if (newName && newName !== fileName) {
    await tp.file.rename(newName);
    fileName = newName;
}

// 2. 获取课程名
let courseName = await tp.system.prompt("2/4 🏫 请输入课程/领域：", "通用");
if (!courseName) courseName = "通用";

// 3. 获取视频源
let videoInput = await tp.system.prompt("3/4 📺 视频链接或文件名 (可选)：", "");
let videoEmbed = "";
if (videoInput) {
    if (videoInput.includes("http")) {
        videoEmbed = `![](${videoInput})`; 
    } else {
        videoEmbed = `![[${videoInput}]]`;
    }
} else {
    videoEmbed = "> *本次学习未关联视频*";
}

// 4. 获取 PDF 源 (新增功能)
let pdfInput = await tp.system.prompt("4/4 📄 PDF 文件名 (可选，无需方括号)：", "");
let pdfEmbed = "";
let annotationTarget = ""; // 用于 Annotator 插件的字段

if (pdfInput) {
    // 自动补全 .pdf 后缀（为了更智能一点）
    if (!pdfInput.toLowerCase().endsWith(".pdf")) {
        pdfInput += ".pdf";
    }
    pdfEmbed = `![[${pdfInput}#height=600]]`; // 默认限制高度，防止刷屏
    annotationTarget = `annotation-target: ${pdfInput}\n`; // 写入 YAML
} else {
    pdfEmbed = "> *本次学习未关联 PDF*";
}

// --- 🚀 头部元数据输出 ---
tR += "---\n"
tR += `created: ${tp.date.now("YYYY-MM-DD HH:mm")}\n`
tR += `course: ${courseName}\n`
tR += "tags:\n  - study\n  - note\n  - video-learning\n"
if (annotationTarget) {
    tR += annotationTarget; // 只有输入了 PDF 才会添加这行
}
tR += "---\n"
tR += `Target Deck: ${courseName}\n\n`
tR += `# ${fileName}\n`
%>

**📅 日期：** <% tp.date.now("YYYY-MM-DD") %>
**🏫 课程：** [[<%* tR += courseName %>]]
**🏷️ 标签：** #study #note

---

## 📺 学习控制台 (Media Extended)
> [!tip] 操作指南
> 1. **右键** 视频链接 -> `Open in Media Extended`
> 2. **Alt+T**：插入时间戳 | **Alt+S**：截图并插入
> 3. **Ctrl+P** -> `Sync with Anki`：一键同步

**视频源：** <%* tR += videoEmbed %>

---

## 📄 参考文档 (PDF)
> [!info] 文档预览
> 如果安装了 **Annotator** 插件，请点击右上角 `More Options` -> `Annotate` 进行批注。

<%* tR += pdfEmbed %>

---

## 🧠 核心概念 (Cues)
> *左侧栏：记录关键问题，复习时遮挡右侧*
- [ ] 

## 📝 笔记内容 (Notes)
<% tp.file.cursor() %>

---

## 💡 总结 (Summary)
> [!summary] 
> 用一句话总结这篇笔记的核心内容。